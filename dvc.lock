schema: '2.0'
stages:
  train_val_split:
    cmd: python challenges/train_val_split.py
    deps:
    - path: challenges/train_val_split.py
      md5: 9939832f90ddf6b28335aaafd6cba70a
      size: 1098
    - path: data/raw/train
      md5: a4da05829c6006bb7be263752f10e8b1.dir
      size: 215577173
      nfiles: 508
    params:
      params.yaml:
        data_dir_train: data/raw/train
        seed: 42
        train_val_split: 0.8
    outs:
    - path: data/processed/train_files.pkl
      md5: 35601749b160f97984b0586236f95ff4
      size: 3542
    - path: data/processed/val_files.pkl
      md5: 7448303f28d0ede78d0c619dbe1ae7ea
      size: 911
  featurize:
    cmd: python challenges/onset-detection/extract_features.py
    deps:
    - path: challenges/onset-detection/extract_features.py
      md5: faa0cb6c8d5a1632de973bd16e876623
      size: 5526
    - path: data/processed/train_files.pkl
      md5: 35601749b160f97984b0586236f95ff4
      size: 3542
    - path: data/processed/val_files.pkl
      md5: 7448303f28d0ede78d0c619dbe1ae7ea
      size: 911
    - path: data/raw/test
      md5: 01ed73995bbf40999fbd40737fcd67e4.dir
      size: 67482988
      nfiles: 50
    params:
      params.yaml:
        data_dir_test: data/raw/test
        featurize:
          fps: 100
    outs:
    - path: data/interim/
      md5: 5e554d3d75e6be2f524db37c0504cd9e.dir
      size: 31271174
      nfiles: 1593
  prepare_labels:
    cmd: python challenges/onset-detection/prepare_labels.py
    deps:
    - path: challenges/onset-detection/prepare_labels.py
      md5: 3503dbdb72d159ee907f26c32fcd7e95
      size: 2258
    - path: data/processed/train_files.pkl
      md5: 35601749b160f97984b0586236f95ff4
      size: 3542
    - path: data/processed/val_files.pkl
      md5: 7448303f28d0ede78d0c619dbe1ae7ea
      size: 911
    params:
      params.yaml:
        featurize.fps: 100
    outs:
    - path: data/processed/train/labels/
      md5: 3ffb40d0c7c99bdb2af8822af0d64c9a.dir
      size: 1177130
      nfiles: 101
    - path: data/processed/val/labels/
      md5: 6466cd807da2a6d3c5bc896560411b0f.dir
      size: 274355
      nfiles: 26
  combine_features:
    cmd: python challenges/onset-detection/combine_features_to_dataframe.py
    deps:
    - path: challenges/onset-detection/combine_features_to_dataframe.py
      md5: 29655520b0835de7aa664090892e5cc6
      size: 2868
    - path: data/interim/
      md5: 5e554d3d75e6be2f524db37c0504cd9e.dir
      size: 31271174
      nfiles: 1593
    - path: data/processed/train/labels
      md5: 3ffb40d0c7c99bdb2af8822af0d64c9a.dir
      size: 1177130
      nfiles: 101
    - path: data/processed/val/labels
      md5: 6466cd807da2a6d3c5bc896560411b0f.dir
      size: 274355
      nfiles: 26
    params:
      params.yaml:
        featurize.fps: 100
    outs:
    - path: data/processed/test/data.csv
      md5: 7d20507899cca35d4d90a89bced80d53
      size: 8300759
    - path: data/processed/train/data.csv
      md5: 300b6f4dfe782999b05f11f1f4a015e5
      size: 24697869
    - path: data/processed/val/data.csv
      md5: 57c5990230614a5f7793dfb64d43440e
      size: 5533133
  train:
    cmd: python challenges/onset-detection/train.py
    deps:
    - path: challenges/onset-detection/train.py
      md5: 8af22e1ab53130e87ace06e66a8d62fd
      size: 1616
    - path: data/processed/train/data.csv
      md5: 300b6f4dfe782999b05f11f1f4a015e5
      size: 24697869
    - path: data/processed/val/data.csv
      md5: 57c5990230614a5f7793dfb64d43440e
      size: 5533133
    params:
      params.yaml:
        seed: 42
        train:
          batch_size: 64
          epochs: 10
          learning_rate: 0.0004
          model_file_name: fastai-tabular
    outs:
    - path: dvclive.json
      md5: 1e3e3923dfaa01a22f9f615b630f56a4
      size: 187
    - path: dvclive/scalars
      md5: a1eaade47c85a084e6a125498af86b18.dir
      size: 1403
      nfiles: 4
    - path: models/
      md5: 445e34112c996265d0fedc79a49571de.dir
      size: 279856
      nfiles: 1
  predict:
    cmd: python challenges/onset-detection/test.py
    deps:
    - path: challenges/onset-detection/test.py
      md5: c4133c95c9800f8986fd3ab3a29a8ebc
      size: 3848
    - path: data/processed/test/data.csv
      md5: 7d20507899cca35d4d90a89bced80d53
      size: 8300759
    - path: data/processed/train/data.csv
      md5: 300b6f4dfe782999b05f11f1f4a015e5
      size: 24697869
    - path: data/processed/val/data.csv
      md5: 57c5990230614a5f7793dfb64d43440e
      size: 5533133
    params:
      params.yaml:
        seed: 42
        train.batch_size: 64
        train.model_file_name: fastai-tabular
    outs:
    - path: reports/test-df.csv
      md5: 60a6dd1a2f5f38c6704f54fe8d452b44
      size: 2443175
    - path: reports/test-onsets.json
      md5: 174b8a29e1323494bebac1f56f09f8ab
      size: 1802
    - path: reports/val-df.csv
      md5: d71c64b57a976d97d8bf4ec8e539c5c1
      size: 2402709
    - path: reports/val-onsets.json
      md5: 06097f5c4efcff649d48f55b62b5cb4d
      size: 1328
    - path: reports/val-targets.json
      md5: 85cc0f756947615a3305c78717fc40cd
      size: 42771
  evaluate:
    cmd: python challenges/onset-detection/eval_onsets.py --submission reports/val-onsets.json
      --target reports/val-targets.json
    deps:
    - path: challenges/onset-detection/eval_onsets.py
      md5: 404f1b7387c917ae73a9c3010aa60874
      size: 1796
    - path: reports/val-onsets.json
      md5: 06097f5c4efcff649d48f55b62b5cb4d
      size: 1328
    - path: reports/val-targets.json
      md5: 85cc0f756947615a3305c78717fc40cd
      size: 42771
    outs:
    - path: metrics.json
      md5: 32cc74b81a034758fb3e00b9d997bd6e
      size: 45
