schema: '2.0'
stages:
  train_val_split:
    cmd: python challenges/train_val_split.py
    deps:
    - path: challenges/train_val_split.py
      md5: 9939832f90ddf6b28335aaafd6cba70a
      size: 1098
    - path: data/raw/train
      md5: a4da05829c6006bb7be263752f10e8b1.dir
      size: 215577173
      nfiles: 508
    params:
      params.yaml:
        data_dir_train: data/raw/train
        seed: 42
        train_val_split: 0.8
    outs:
    - path: data/processed/train_files.pkl
      md5: 35601749b160f97984b0586236f95ff4
      size: 3542
    - path: data/processed/val_files.pkl
      md5: 7448303f28d0ede78d0c619dbe1ae7ea
      size: 911
  featurize:
    cmd: python challenges/onset-detection/extract_features.py
    deps:
    - path: challenges/onset-detection/extract_features.py
      md5: fd90563996213e50dc38f3efda82067a
      size: 6424
    - path: data/processed/train_files.pkl
      md5: 35601749b160f97984b0586236f95ff4
      size: 3542
    - path: data/processed/val_files.pkl
      md5: 7448303f28d0ede78d0c619dbe1ae7ea
      size: 911
    - path: data/raw/test
      md5: 01ed73995bbf40999fbd40737fcd67e4.dir
      size: 67482988
      nfiles: 50
    params:
      params.yaml:
        data_dir_test: data/raw/test
        featurize:
          fps: 20.0
          frame_size: 4410
          ewm_spans:
          - 3
          - 6
    outs:
    - path: data/interim/
      md5: 065be26027276539f1651780f4cf74de.dir
      size: 33545328
      nfiles: 8496
  prepare_labels:
    cmd: python challenges/onset-detection/prepare_labels.py
    deps:
    - path: challenges/onset-detection/prepare_labels.py
      md5: badcf59a38acc805fe5686982a16226b
      size: 2433
    - path: data/processed/train_files.pkl
      md5: 35601749b160f97984b0586236f95ff4
      size: 3542
    - path: data/processed/val_files.pkl
      md5: 7448303f28d0ede78d0c619dbe1ae7ea
      size: 911
    params:
      params.yaml:
        featurize.fps: 20.0
    outs:
    - path: data/processed/train/labels/
      md5: 7f42114b1f680f49e227559b81883a5b.dir
      size: 227382
      nfiles: 101
    - path: data/processed/val/labels/
      md5: d8248375f9a19feb680c611681a25358.dir
      size: 52828
      nfiles: 26
  combine_features:
    cmd: python challenges/onset-detection/combine_features_to_dataframe.py
    deps:
    - path: challenges/onset-detection/combine_features_to_dataframe.py
      md5: 22619d902ff6baa5710562c9c6f37bdc
      size: 2729
    - path: data/interim/
      md5: 065be26027276539f1651780f4cf74de.dir
      size: 33545328
      nfiles: 8496
    - path: data/processed/train/labels
      md5: 7f42114b1f680f49e227559b81883a5b.dir
      size: 227382
      nfiles: 101
    - path: data/processed/val/labels
      md5: d8248375f9a19feb680c611681a25358.dir
      size: 52828
      nfiles: 26
    params:
      params.yaml:
        featurize.fps: 20.0
        featurize.frame_size: 4410
    outs:
    - path: data/processed/test/data.csv
      md5: fd86cf81228529a6bab6e9f0b21416e8
      size: 7447452
    - path: data/processed/train/data.csv
      md5: ca4aecbdac3eb921b9c00f9c59a56f65
      size: 19918003
    - path: data/processed/val/data.csv
      md5: 8829a1bf8661608edfb9490ed2cc0ae6
      size: 4589197
  train:
    cmd: python challenges/onset-detection/train.py
    deps:
    - path: challenges/onset-detection/train.py
      md5: 10ba433e6eee8bcbb1d1f62a1d13cb2e
      size: 2307
    - path: data/processed/train/data.csv
      md5: ca4aecbdac3eb921b9c00f9c59a56f65
      size: 19918003
    - path: data/processed/val/data.csv
      md5: 8829a1bf8661608edfb9490ed2cc0ae6
      size: 4589197
    params:
      params.yaml:
        seed: 42
        train:
          batch_size: 128
          epochs: 24
          learning_rate: 0.01
          weight_decay: 1e-05
          model_file_name: fastai-tabular
    outs:
    - path: dvclive.json
      md5: 396732dd0667aa198e2806bf5201c43b
      size: 363
    - path: dvclive/scalars
      md5: 8a32fdd280e4c549aab25ada37e6807c.dir
      size: 6004
      nfiles: 7
    - path: models/fastai-tabular.pth
      md5: 0d2d64db02e971280eba3bdc4f72c57b
      size: 2977395
  predict:
    cmd: python challenges/onset-detection/test.py
    deps:
    - path: challenges/onset-detection/test.py
      md5: 3720b3e1a629a638d29f09525082e1a4
      size: 4812
    - path: data/processed/test/data.csv
      md5: fd86cf81228529a6bab6e9f0b21416e8
      size: 7447452
    - path: data/processed/train/data.csv
      md5: ca4aecbdac3eb921b9c00f9c59a56f65
      size: 19918003
    - path: data/processed/val/data.csv
      md5: 8829a1bf8661608edfb9490ed2cc0ae6
      size: 4589197
    - path: models/fastai-tabular.pth
      md5: 0d2d64db02e971280eba3bdc4f72c57b
      size: 2977395
    params:
      params.yaml:
        seed: 42
        train.batch_size: 128
        train.model_file_name: fastai-tabular
    outs:
    - path: reports/test-df.csv
      md5: 503897dd0d0acf01b202fd777d9580e9
      size: 483333
    - path: reports/test-onsets.json
      md5: d3b3acd55151e87af7344fc2e55e821c
      size: 105283
    - path: reports/val-df.csv
      md5: b9e48f33b42468718ad8b4b8c8e79ad3
      size: 472742
    - path: reports/val-onsets.json
      md5: 3217fca90a8b81a422d25900fcdaafaa
      size: 71775
    - path: reports/val-targets.json
      md5: c37b5afe0598a57fd5b6fd0dc8e4c9a3
      size: 41254
  evaluate:
    cmd: python challenges/onset-detection/eval_onsets.py --submission reports/val-onsets.json
      --target reports/val-targets.json
    deps:
    - path: challenges/onset-detection/eval_onsets.py
      md5: 404f1b7387c917ae73a9c3010aa60874
      size: 1796
    - path: reports/val-onsets.json
      md5: 3217fca90a8b81a422d25900fcdaafaa
      size: 71775
    - path: reports/val-targets.json
      md5: c37b5afe0598a57fd5b6fd0dc8e4c9a3
      size: 41254
    outs:
    - path: metrics.json
      md5: 7a054cd3af21305df05c7a632c34adaf
      size: 41
