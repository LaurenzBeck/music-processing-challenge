schema: '2.0'
stages:
  train_val_split:
    cmd: python challenges/train_val_split.py
    deps:
    - path: challenges/train_val_split.py
      md5: 9939832f90ddf6b28335aaafd6cba70a
      size: 1098
    - path: data/raw/train
      md5: a4da05829c6006bb7be263752f10e8b1.dir
      size: 215577173
      nfiles: 508
    params:
      params.yaml:
        data_dir_train: data/raw/train
        seed: 42
        train_val_split: 0.8
    outs:
    - path: data/processed/train_files.pkl
      md5: 35601749b160f97984b0586236f95ff4
      size: 3542
    - path: data/processed/val_files.pkl
      md5: 7448303f28d0ede78d0c619dbe1ae7ea
      size: 911
  featurize:
    cmd: python challenges/onset-detection/extract_features.py
    deps:
    - path: challenges/onset-detection/extract_features.py
      md5: 9b65dd52c017baba131d928d27eb2ef7
      size: 4644
    - path: data/processed/train_files.pkl
      md5: 35601749b160f97984b0586236f95ff4
      size: 3542
    - path: data/processed/val_files.pkl
      md5: 7448303f28d0ede78d0c619dbe1ae7ea
      size: 911
    - path: data/raw/test
      md5: 01ed73995bbf40999fbd40737fcd67e4.dir
      size: 67482988
      nfiles: 50
    params:
      params.yaml:
        data_dir_test: data/raw/test
        featurize:
          fps: 20.0
          frame_size: 4410
    outs:
    - path: data/interim/
      md5: 2abe34f3f4059652e1a6922a62553ebc.dir
      size: 6304380
      nfiles: 1593
  prepare_labels:
    cmd: python challenges/onset-detection/prepare_labels.py
    deps:
    - path: challenges/onset-detection/prepare_labels.py
      md5: badcf59a38acc805fe5686982a16226b
      size: 2433
    - path: data/processed/train_files.pkl
      md5: 35601749b160f97984b0586236f95ff4
      size: 3542
    - path: data/processed/val_files.pkl
      md5: 7448303f28d0ede78d0c619dbe1ae7ea
      size: 911
    params:
      params.yaml:
        featurize.fps: 20.0
    outs:
    - path: data/processed/train/labels/
      md5: 7f42114b1f680f49e227559b81883a5b.dir
      size: 227382
      nfiles: 101
    - path: data/processed/val/labels/
      md5: d8248375f9a19feb680c611681a25358.dir
      size: 52828
      nfiles: 26
  combine_features:
    cmd: python challenges/onset-detection/combine_features_to_dataframe.py
    deps:
    - path: challenges/onset-detection/combine_features_to_dataframe.py
      md5: 22619d902ff6baa5710562c9c6f37bdc
      size: 2729
    - path: data/interim/
      md5: 2abe34f3f4059652e1a6922a62553ebc.dir
      size: 6304380
      nfiles: 1593
    - path: data/processed/train/labels
      md5: 7f42114b1f680f49e227559b81883a5b.dir
      size: 227382
      nfiles: 101
    - path: data/processed/val/labels
      md5: d8248375f9a19feb680c611681a25358.dir
      size: 52828
      nfiles: 26
    params:
      params.yaml:
        featurize.fps: 20.0
        featurize.frame_size: 4410
    outs:
    - path: data/processed/test/data.csv
      md5: 0ba6fceaa87498ca0cf85274922e1d44
      size: 1671364
    - path: data/processed/train/data.csv
      md5: 3649bbaf160feecb9d2c33026ab1fb6b
      size: 4958491
    - path: data/processed/val/data.csv
      md5: bd92e77f82d7e29e69457ba2075b33d5
      size: 1110794
  train:
    cmd: python challenges/onset-detection/train.py
    deps:
    - path: challenges/onset-detection/train.py
      md5: dd75fd25e928631a8e14463091ef2402
      size: 2359
    - path: data/processed/train/data.csv
      md5: 3649bbaf160feecb9d2c33026ab1fb6b
      size: 4958491
    - path: data/processed/val/data.csv
      md5: bd92e77f82d7e29e69457ba2075b33d5
      size: 1110794
    params:
      params.yaml:
        seed: 42
        train:
          batch_size: 128
          epochs: 42
          learning_rate: 0.01
          weight_decay: 1e-05
          model_file_name: fastai-tabular
    outs:
    - path: dvclive.json
      md5: 5d0d78bda272de5f4e7f038f2b7c3b63
      size: 342
    - path: dvclive/scalars
      md5: bb344950ae54ed987aab9757620f0745.dir
      size: 9402
      nfiles: 7
    - path: models/fastai-tabular.pth
      md5: 12f3d37ea3d63a7f1ed1ef31201686de
      size: 2260136
  predict:
    cmd: python challenges/onset-detection/test.py
    deps:
    - path: challenges/onset-detection/test.py
      md5: e474fd9ddbd577e2a27e1e48ec5a8f1c
      size: 4799
    - path: data/processed/test/data.csv
      md5: 0ba6fceaa87498ca0cf85274922e1d44
      size: 1671364
    - path: data/processed/train/data.csv
      md5: 3649bbaf160feecb9d2c33026ab1fb6b
      size: 4958491
    - path: data/processed/val/data.csv
      md5: bd92e77f82d7e29e69457ba2075b33d5
      size: 1110794
    - path: models/fastai-tabular.pth
      md5: 12f3d37ea3d63a7f1ed1ef31201686de
      size: 2260136
    params:
      params.yaml:
        seed: 42
        train.batch_size: 128
        train.model_file_name: fastai-tabular
    outs:
    - path: reports/test-df.csv
      md5: 842cd087419d912ac1ab3d06ca1c720b
      size: 447929
    - path: reports/test-onsets.json
      md5: f5ab1e36eeeaf98792bff1842fb3a7d0
      size: 223362
    - path: reports/val-df.csv
      md5: 2c891abc99683d8efece623f0443d279
      size: 451391
    - path: reports/val-onsets.json
      md5: 5d0c3696a24b2e5e7c91cccda734d263
      size: 134822
    - path: reports/val-targets.json
      md5: 2d8a9f226fd44344a30d7edacb637794
      size: 41316
  evaluate:
    cmd: python challenges/onset-detection/eval_onsets.py --submission reports/val-onsets.json
      --target reports/val-targets.json
    deps:
    - path: challenges/onset-detection/eval_onsets.py
      md5: 404f1b7387c917ae73a9c3010aa60874
      size: 1796
    - path: reports/val-onsets.json
      md5: 5d0c3696a24b2e5e7c91cccda734d263
      size: 134822
    - path: reports/val-targets.json
      md5: 2d8a9f226fd44344a30d7edacb637794
      size: 41316
    outs:
    - path: metrics.json
      md5: 121597aed7c45420e6261cf092751458
      size: 42
